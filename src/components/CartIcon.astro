---
import { useStore } from "@nanostores/react";
import { cartItemCount, toggleCart } from "../stores/cart";

interface Props {
    className?: string;
}

const { className = "" } = Astro.props;
---

<div class={`cart-icon-wrapper ${className}`}>
    <button
        id="cart-toggle"
        class="cart-icon-button"
        aria-label="Shopping cart"
    >
        <svg
            class="cart-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
            ></path>
        </svg>
        <span id="cart-count" class="cart-count">0</span>
    </button>
</div>

<script>
    import { cartItemCount } from "../stores/cart";

    // Update cart count display
    cartItemCount.subscribe((count) => {
        const cartCountElement = document.getElementById("cart-count");
        if (cartCountElement) {
            cartCountElement.textContent = count.toString();
            cartCountElement.style.display = count > 0 ? "flex" : "none";
        }
    });

    // Handle cart toggle
    const cartToggle = document.getElementById("cart-toggle");
    if (cartToggle) {
        cartToggle.addEventListener("click", () => {
            window.location.href = "/cart";
        });
    }
</script>

<style>
    .cart-icon-wrapper {
        position: relative;
    }

    .cart-icon-button {
        position: relative;
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
    }

    .cart-icon-button:hover {
        transform: scale(1.1);
    }

    .cart-icon {
        width: 1.5rem;
        height: 1.5rem;
        color: var(--color-text, #e8f5e1);
    }

    .cart-count {
        position: absolute;
        top: 0;
        right: 0;
        background: var(--color-primary, #7cb342);
        color: var(--color-bg, #0a1612);
        font-size: 0.75rem;
        font-weight: 700;
        min-width: 1.25rem;
        height: 1.25rem;
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 0.125rem;
        animation: pop 0.3s ease;
    }

    @keyframes pop {
        0% {
            transform: scale(0);
        }
        50% {
            transform: scale(1.2);
        }
        100% {
            transform: scale(1);
        }
    }
</style>
